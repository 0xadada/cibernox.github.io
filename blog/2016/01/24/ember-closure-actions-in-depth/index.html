
<!doctype html>
<html lang="pt-br">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  

  

  

  

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=860">

  <meta name="author" content="Miguel Camba" />
  <link rel="publisher" href="https://plus.google.com/+104848632337303003619" />
  <meta property="og:title" content="Ember Closure Actions in Depth - Coder idiosyncrasy" />
  <meta property="og:site_name" content="Coder idiosyncrasy" />
  <meta property="og:type" content="article" />
  <meta property="og:locale" content="pt-BR" />
  <meta name="description" content="Ember Closure Actions in Depth Jan 24th, 2016 9:24 am, ember.js I&rsquo;ve been using Ember&rsquo;s closure actions in all my projects for a while &hellip;" />
  <meta property="og:description" content="Ember Closure Actions in Depth Jan 24th, 2016 9:24 am, ember.js I&rsquo;ve been using Ember&rsquo;s closure actions in all my projects for a while now and I like them so much
that I almost take for granted that everybody has embraced them too. While it&rsquo;s true that most ember devs have started using them, I&rsquo;ve seen that many people haven&rsquo;t fully
grasped all its potential and the &hellip;" />
  <meta property="og:url" content="http://miguelcamba.com/blog/2016/01/24/ember-closure-actions-in-depth/" />
  <meta property="og:image" content="http://miguelcamba.com/images/" />

  <meta property="article:author" content="https://www.facebook.com/" />
  <meta property="article:publisher" content="https://www.facebook.com/" />

  
    <meta name="keywords" content="actions, closure, ember" />
  

  <title>Ember Closure Actions in Depth - Coder idiosyncrasy</title>

  <link rel="canonical" href="http://miguelcamba.com/blog/2016/01/24/ember-closure-actions-in-depth">
  <link href="  /favicon.ico" rel="icon">
  <link href="http://fonts.googleapis.com/css?family=Crete+Round:400" rel="stylesheet" type="text/css">
  <link href="  /stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Coder idiosyncrasy" type="application/atom+xml">
</head>

  <body  id="post" >
    <div class="cover-image"></div>

<header id="header" role="banner" class="internal-page">
  <div class="content">
    <h1><a href="  /">Coder idiosyncrasy</a></h1>
    <h1 id="second-link"><a href="/talks">Talks</a></h1>
    <h1 id="third-link"><a href="/about">About</a></h1>
    
  </div>
</header>

    <main role="main">
      <div class="content">
  <article role="article">
    
  <header>
    <h1>
    
      
        Ember Closure Actions in Depth
      
    
    </h1>

    
      





      <span class="meta">
        <time class='entry-date' datetime='2016-01-24T09:24:56+00:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:24 am</span></time>,
        

  <span class="categories">
    
      <a class='category' href='  /blog/categories/ember-dot-js/'>ember.js</a>
    
  </span>


        


      </span>
    
  </header>



  <p>I&rsquo;ve been using Ember&rsquo;s closure actions in all my projects for a while now and I like them so much
that I almost take for granted that everybody has embraced them too.</p>

<p>While it&rsquo;s true that most ember devs have started using them, I&rsquo;ve seen that many people haven&rsquo;t fully
grasped all its potential and the new patterns they enable, so I want to explain them a bit more,
starting from the basics and going towards more advanced patterns.</p>

<!-- more -->


<h2>What is a closure action?</h2>

<p>First things first, let&rsquo;s see a few actions in the wild.</p>

<p>Which ones of these are closure actions?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;button</span> <span class="err">{{</span><span class="na">action</span> <span class="err">&quot;</span><span class="na">sayHi</span><span class="err">&quot;}}</span><span class="nt">&gt;</span>Salute<span class="nt">&lt;/button&gt;</span>
</span><span class='line'><span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{{action</span> <span class="err">&quot;</span><span class="na">sayHi</span><span class="err">&quot;}}</span><span class="nt">&gt;&lt;/button&gt;</span>
</span><span class='line'>{{my-button action=(action &quot;sayHi&quot;)}}
</span><span class='line'>{{my-button action=&quot;sayHi&quot;}}
</span></code></pre></td></tr></table></div></figure>


<p>If you said 2nd and 3rd you guessed right.</p>

<p>The 4th example is clearly just a regular attribute passing. It is named <code>action</code> but could be named <code>weasel</code>
and would be exactly the same, just a string.</p>

<p>The 1st line is a bit more fuzzy. That line is telling Ember to invoke the &ldquo;sayHi&rdquo; action when the button
is clicked. <strong>Why doesn&rsquo;t it qualify as a closure action?</strong></p>

<p>We have to start by explaining that the <code>action</code> helper is overloaded and, depending on which context it is used in,
it does entirely different things.</p>

<h3><code>action</code> in the &ldquo;element space&rdquo;</h3>

<p>When invoked within the context of an html element (what is known as the <em>&ldquo;element&rsquo;s space&rdquo;</em>),
the <code>action</code> keyword does a quite a lot of stuff.
It registers in the global Ember dispatcher one (or some) handlers for events whose target is the element in
which it was invoked.</p>

<p>In the first line of the previous example, the helper is registering in the event handler for the <code>click</code>
attached automatically by Ember to the root of your app, a handler that will be invoked when
the target of the event is that button. It&rsquo;s also doing the same thing for the <code>keypress</code> event when
the pressed key is <kbd>enter</kbd>. That handler, in turn, will call the <code>sayHi</code> action on the context of that template.</p>

<p>Apart from all that, the action helper will call <code>preventDefault()</code> on that event, hijacking its default
behavior, like by example submitting the form in which that button lives. However, that will not
prevent the event from bubbling.</p>

<p>Both behaviors can be tuned from the template with options:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;button</span> <span class="err">{{</span><span class="na">action</span> <span class="err">&quot;</span><span class="na">sayHi</span><span class="err">&quot;</span> <span class="na">preventDefault=</span><span class="s">false</span> <span class="na">bubble=</span><span class="s">false}}</span><span class="nt">&gt;</span>Salute<span class="nt">&lt;/button&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>By default the <code>action</code> helper registers for DOM click events but you can specify a different event name:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;button</span> <span class="err">{{</span><span class="na">action</span> <span class="err">&quot;</span><span class="na">sayHi</span><span class="err">&quot;</span> <span class="na">on=</span><span class="s">&quot;double-click&quot;</span><span class="err">}}</span><span class="nt">&gt;</span>Salute<span class="nt">&lt;/button&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As we see, there is quite a process involved here, but this is not a closure action.</p>

<h3><code>action</code> as a closure creator</h3>

<p>On the other hand, the second usage of this helper is as <em>closure creator</em>. This is the behavior the
helper has in <strong>any</strong> other situation different than the one described above.</p>

<p>It does something much simpler but also much more powerful. <strong>It creates a function with a closure that invokes another function</strong></p>

<p>That&rsquo;s it. You can think about it almost like this snippet:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">createClosureAction</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">func</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>Note: This is an oversimplification. Closure actions don&rsquo;t even use <code>Function#bind</code> at all, but it&rsquo;s close enough to grasp the basics.</em></p>

<p>It does nothing else. It doesn&rsquo;t register any event handler, doesn&rsquo;t prevent default or stop bubbling. It just
binds the given function to the current context and arguments. When provided with a string it will assume that
it&rsquo;s the name of an action and will extract it from the current context.</p>

<p>So, if it is such a simple helper, why is it so cool?</p>

<h3>The good parts of being a function</h3>

<p>Converting your actions to functions you can pass around has many advantages.</p>

<h4><strong>Simpler mental model</strong></h4>

<p>This one is often understated.</p>

<p>A function is a value. <code>{{my-component foo=bar}}</code>
in a template means that we&rsquo;re passing to the component a property named <code>"foo"</code> whose value is the value in <code>bar</code>. What if <code>bar</code>
is a function? Nothing: it&rsquo;s the same idea. We&rsquo;re just passing a value.</p>

<p>What if we do <code>{{yield (action &ldquo;submit&rdquo;)</code>? Same thing, we&rsquo;re just yielding a value that happens
to be a function. That is all.</p>

<h4><strong>Detect errors eagerly</strong></h4>

<p>On this usage, <code>{{action &ldquo;foo&rdquo;}}</code> is a helper and as such, tries to do its work as soon as the
template is rendered. If the current context doesn&rsquo;t have a function named <code>foo</code> it will fail right away,
unlike <em>element&rsquo;s space</em> usage where it will fail at runtime when that event is fired and, oh surprise,
there is no action named <code>foo</code>!!</p>

<p>It still surprises me how many refactoring bugs this simple feature has caught for me.</p>

<h4><strong>Return values</strong></h4>

<p>Functions have return values. Closure actions are functions. Therefore <em>modus ponendo ponens</em>, closure actions have
return values too.</p>

<p>If the component calls <code>this.get("foo")("someArg")</code>, it is just invoking a function and will have access
to its return value, if any. This enables bidirectional communication with the parent context.</p>

<p>As a real world example, an <code>{{async-button action=(action &ldquo;submit&rdquo;)}}</code> will invoke the action and that
action can return a promise. Thanks to having access to that promise, the button can then change to a &ldquo;loading&rdquo;
state while that returned promise is pending.</p>

<h4><strong>Removes logic from middlemen</strong></h4>

<p>Actions can be passed down/up as many levels as desired.</p>

<p>When passing actions as just strings with their names to be invoked with the <code>sendAction(actionName)</code> in the receiver
component, each call to <code>sendAction</code> will only reach the closest component in the hierarchy.
This means that when the logic to be executed lives a few layers up from where the event that triggers it
is fired, each one of the intermediate components has to define an action to capture and re-thorw the
call to the next level.</p>

<p>That is a lot of coupling.</p>

<p>Closure actions just being functions bound to a given scope means that they can just be passed as simple
values from the root to the leaves. Then, the last component in the chain can invoke that action with
via <code>this.get("functionName")()</code> and it will be executed with the provided arguments in the correct
scope, releasing intermediate nodes in the chain of the burden of capture-and-rethrow actions by its name.</p>

<h4><strong>Closure actions as event handlers</strong></h4>

<p>When we attach a closure action to an event handler like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{{action</span> <span class="err">&quot;</span><span class="na">sayHi</span><span class="err">&quot;}}</span><span class="nt">&gt;&lt;/button&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ember.js is just doing</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">button</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="nx">wrappedSayHiFunction</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>That means that, as with all event handlers attached to DOM elements, it is invoked with the <code>event</code>
as first argument. But since the handler function already has one argument bound, the event is received
as the second argument instead.</p>

<p>There is little-to-no magic happening here, just regular javascript.</p>

<p>That also means that is up to the user to call <em>preventDefault</em> or <em>stopPropagation</em> on the received event.</p>

<h4><strong>Not only actions can be actions</strong></h4>

<p>Tipically when using the <code>action</code> helper you will pass a string containing the name of some function
that lives in the <code>actions</code> property of your component, like this: <code>&lt;button onclick={{action "sayHi"}}&gt;&lt;/button&gt;</code></p>

<p>But did you know that you can extract any function from your component by passed an unquoted reference?</p>

<figure class='code'><figcaption><span>template.hbs </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{{action</span> <span class="na">sayHi</span><span class="err">}}</span><span class="nt">&gt;&lt;/button&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>component.js </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Component</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">actions</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// empty</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">sayHi</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hi!&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is useful by example if you want a component to execute some arbitrary logic that can be decided
by its parent, and passed as an argument.</p>

<figure class='code'><figcaption><span>my-button/template.hbs </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{{action</span> <span class="na">clickHandler</span><span class="err">}}</span><span class="nt">&gt;&lt;/button&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>salutator/template.hbs </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{{my-button clickHandler=sayHi}}
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>salutator/component.js </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Component</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">sayHi</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hi!&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that you know that it&rsquo;s possible, <strong>I strongly discourage you to do this.</strong></p>

<p>This enters the personal opinion realm but I feel that <strong>if we start extracting methods of components
to use them as actions, why do we have the <code>actions</code> hash at all?</strong></p>

<p>Instead, when I want to be able to customize from outside a component what an action will do, I define
an action inside the component that just delegates all its logic to a method that can be passed in from
the outside.</p>

<figure class='code'><figcaption><span>my-button/template.hbs </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{{action</span> <span class="err">&quot;</span><span class="na">clickHandler</span><span class="err">&quot;}}</span><span class="nt">&gt;&lt;/button&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>my-button/component.js </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Component</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">actions</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">clickHandler</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">clickHandler</span><span class="p">(...</span><span class="nx">arguments</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">clickHanldler</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;clickHandler must be provided!!&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>salutator/template.hbs </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{{my-button clickHandler=sayHi}}
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>salutator/component.js </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Component</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">sayHi</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hi!&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>The behavior is the same but reading the code of the component is crystal clear that <code>clickHandler</code>
is intended to be passed from the outside. I find this approach self-documented and more idiomatic.</p>

<h4><strong>Currying</strong></h4>

<p>Taken from the wikipedia:</p>

<p><em>Currying is the technique of translating the evaluation of a function that takes multiple arguments (or a tuple of arguments) into evaluating a sequence of functions</em></p>

<p>Without deep diving into Haskell theory and monad madness, let me only explain how you can apply this
technique for your own benefit with an example.</p>

<p>Having this declaration in the templates:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{{my-form onSubmit=(action &quot;submitWithAjax&quot; &quot;/users/registration&quot;)}}
</span><span class='line'>
</span><span class='line'><span class="c">&lt;!-- Within my-form.hbs --&gt;</span>
</span><span class='line'>{{my-button onUsage=(action onSubmit data)}}
</span><span class='line'>
</span><span class='line'><span class="c">&lt;!-- Within my-button.hbs --&gt;</span>
</span><span class='line'><span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{{onUsage}}</span><span class="nt">&gt;&lt;/button&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the <code>sendWithAjax</code> function of the top-most scope:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">actions</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">submitWithAjax</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// how come do I receive 3 arguments?!?!111</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>Because currying</em>.</p>

<p>Each invocation of the <code>action</code> helper created a new closure and bound the given
arguments to the function. The first invocation bound the <code>this</code> to the current context and the
first arguments to the string <code>"/users/registration"</code>. The second invocation bound the data to the function.
Since the context and the first argument were already bound, that argument takes the 2nd position.
Last, but not least, that function is assigned to the <code>onclick</code> property of that DOM element, and when
it&rsquo;s invoked the event is passed, occupying the last position in the arguments list.</p>

<p>Translated to javascript, it&rsquo;s more or less equivalent to:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">let</span> <span class="nx">funcOne</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="s2">&quot;/users/registration&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">// ...</span>
</span><span class='line'><span class="kd">let</span> <span class="nx">funcTwo</span> <span class="o">=</span> <span class="nx">funcOne</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">secondContext</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
</span><span class='line'><span class="c1">// ...</span>
</span><span class='line'><span class="nx">button</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="nx">funcTwo</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Using currying each level can augment the action with some extra arguments, and that frees the last
level of the chain of the responsibility of holding all the information needed to perform the action.
Each piece of data can live in the level where it makes more sense, without leaking outside it.</p>

<h4><strong>Extracting values out of the first argument</strong></h4>

<p>The <em>action</em> helper accepts a set of key/value pairs as last argument. One special option you can use
is the <code>value</code> option. This option holds a path, and the closure action will be invoked with the
value contained in that path on the first argument instead of the first argument.</p>

<p>The most common example of this is to extract some value out of the event.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">onchange=</span><span class="s">{{action</span> <span class="err">&quot;</span><span class="na">logArgs</span><span class="err">&quot;}}</span><span class="nt">&gt;</span> <span class="c">&lt;!-- Logs `[event]` --&gt;</span>
</span><span class='line'><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">onchange=</span><span class="s">{{action</span> <span class="err">&quot;</span><span class="na">logArgs</span><span class="err">&quot;</span> <span class="na">value=</span><span class="s">&quot;target.value&quot;</span><span class="err">}}</span><span class="nt">&gt;</span> <span class="c">&lt;!-- Logs the value of the input (e.target.input) --&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>But often people doesn&rsquo;t realize that it works with anything, not only events. Per example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{{action</span> <span class="err">&quot;</span><span class="na">logArgs</span><span class="err">&quot;</span> <span class="err">&quot;</span><span class="na">abcde</span><span class="err">&quot;</span> <span class="na">value=</span><span class="s">&quot;length&quot;</span><span class="err">}}</span><span class="nt">&gt;</span> <span class="c">&lt;!-- Logs `[5]` --&gt;</span>
</span><span class='line'><span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{{action</span> <span class="err">(</span><span class="na">action</span> <span class="err">&quot;</span><span class="na">logArgs</span><span class="err">&quot;</span> <span class="err">&quot;</span><span class="na">foo</span><span class="err">&quot;</span> <span class="na">value=</span><span class="s">&quot;length&quot;</span><span class="err">)</span> <span class="na">value=</span><span class="s">&quot;screenX&quot;</span><span class="err">}}</span><span class="nt">&gt;</span>Press me<span class="nt">&lt;/button&gt;</span> <span class="c">&lt;!-- Logs `[3, 741]` --&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is specially useful when combined with the next point.</p>

<h4><strong>DDAU and the <code>mut</code> helper</strong></h4>

<p>The Data Down - Actions Up approach to propagate state changes in an app advices us to not rely on two-way
bindings for mutating state but on explicit function invocations. Consider the next code example:</p>

<figure class='code'><figcaption><span>template.hbs </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;p&gt;</span>Select shipment type<span class="nt">&lt;/p&gt;</span>
</span><span class='line'><span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{{action</span> <span class="err">&quot;</span><span class="na">selectShipmentType</span><span class="err">&quot;</span> <span class="err">&quot;</span><span class="na">regularDelivery</span><span class="err">&quot;}}</span><span class="nt">&gt;</span>Standard delivery<span class="nt">&lt;/button&gt;</span>
</span><span class='line'><span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{{action</span> <span class="err">&quot;</span><span class="na">selectShipmentType</span><span class="err">&quot;</span> <span class="err">&quot;</span><span class="na">urgent</span><span class="err">&quot;}}</span><span class="nt">&gt;</span>48h delivery<span class="nt">&lt;/button&gt;</span>
</span><span class='line'><span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{{action</span> <span class="err">&quot;</span><span class="na">selectShipmentType</span><span class="err">&quot;</span> <span class="err">&quot;</span><span class="na">next-day</span><span class="err">&quot;}}</span><span class="nt">&gt;</span>Next day delivery<span class="nt">&lt;/button&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>component.js </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">actions</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">selectShipmentType</span><span class="p">(</span><span class="nx">type</span> <span class="cm">/*, e */</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;shipmentType&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Pretty common. Changing the selection invokes the <code>selectShipmentType</code> action with one value, and that
action mutates some value. However, setting some state as result of some user interaction is so common
that there is a built-in way to avoid having to define such simple functions over and over: the <code>mut</code> helper.</p>

<p>This helper creates a function that will set on some property the first argument it receives. The following
code is equivalent.</p>

<figure class='code'><figcaption><span>template.hbs </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;p&gt;</span>Select shipment type<span class="nt">&lt;/p&gt;</span>
</span><span class='line'><span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{{action</span> <span class="err">(</span><span class="na">mut</span> <span class="na">shipmentType</span><span class="err">)</span> <span class="err">&quot;</span><span class="na">regularDelivery</span><span class="err">&quot;}}</span><span class="nt">&gt;</span>Standard delivery<span class="nt">&lt;/button&gt;</span>
</span><span class='line'><span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{{action</span> <span class="err">(</span><span class="na">mut</span> <span class="na">shipmentType</span><span class="err">)</span> <span class="err">&quot;</span><span class="na">urgent</span><span class="err">&quot;}}</span><span class="nt">&gt;</span>48h delivery<span class="nt">&lt;/button&gt;</span>
</span><span class='line'><span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{{action</span> <span class="err">(</span><span class="na">mut</span> <span class="na">shipmentType</span><span class="err">)</span> <span class="err">&quot;</span><span class="na">next-day</span><span class="err">&quot;}}</span><span class="nt">&gt;</span>Next day delivery<span class="nt">&lt;/button&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This, in combination with the <code>value</code> option, can save you the tedium of defining super simple functions
to extract some attribute from the first argument.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;p&gt;</span>The mouse X position is: {{mouseX}}<span class="nt">&lt;/p&gt;</span>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;draw-canvas&quot;</span> <span class="na">onmousemove=</span><span class="s">{{action</span> <span class="err">(</span><span class="na">mut</span> <span class="na">mouseX</span><span class="err">)</span> <span class="na">value=</span><span class="s">&quot;screenX&quot;</span><span class="err">}}</span><span class="nt">&gt;&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Remember that you can use this not only with events but with any object.</p>

<p>For example, if you want to have an instance of <a href="http://www.ember-power-select.com">Ember Power Select</a> bound to some
<em>queryParam</em>, you can do this:</p>

<figure class='code'><figcaption><span>controller.js </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">queryParams</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;teacherId&#39;</span><span class="p">]</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>route.js </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">queryParams</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">teacherId</span><span class="o">:</span> <span class="p">{</span> <span class="nx">refreshModel</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">model</span><span class="p">({</span> <span class="nx">teacherId</span> <span class="p">})</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s1">&#39;homework&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">teacherId</span> <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>helpers/find-by.js </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">import</span> <span class="nx">Ember</span> <span class="nx">from</span> <span class="s1">&#39;ember&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Helper</span><span class="p">.</span><span class="nx">helper</span><span class="p">(</span><span class="kd">function</span><span class="p">([</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">attrName</span><span class="p">,</span> <span class="nx">attrValue</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">el</span> <span class="o">=&gt;</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">attrName</span><span class="p">)</span> <span class="o">===</span> <span class="nx">attrValue</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>template.hbs </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;p&gt;</span>Select a teacher to filter homework<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>{{#power-select options=teachers selected=(find-by teachers &#39;id&#39; teacherId) onchange=(action (mut teacherId) value=&quot;id&quot;) as |teacher|}}
</span><span class='line'>  {{teacher.fullName}} - {{teacher.group.name}}
</span><span class='line'>{{/power-select}}
</span></code></pre></td></tr></table></div></figure>


<p>Selecting a teacher will pass that <code>Teacher</code> model to the <code>onchange</code> function. From that teacher
we extract only the <code>id</code> with <code>value="id"</code> which is passed to <code>(mut teacherId)</code> as its first argument.
That updates the <code>teacherId</code> property in the controller, that is bound to a <em>queryParam</em> in the URL,
tehen refreshing the model hook of the route.</p>

<p>Neat.</p>

<h2>Summary</h2>

<p>Going forward the Ember 2.0 path, closure actions are one of the tools in your belt you&rsquo;re going to
use more often.</p>

<p>Understanding them fully will allow you to squeeze them to your advantage and write simpler and more maintainable
code.</p>



    <footer>
      
        <div class="sharing">
  
    <a href="//twitter.com/share" class="twitter-share-button" data-url="http://miguelcamba.com/blog/2016/01/24/ember-closure-actions-in-depth/" data-via="miguelcamba" data-counturl="http://miguelcamba.com/blog/2016/01/24/ember-closure-actions-in-depth/">Tweet</a>
  

  
    <div class="fb-like" data-href="http://miguelcamba.com/blog/2016/01/24/ember-closure-actions-in-depth/" data-layout="button_count" data-action="recommend" data-show-faces="true" data-share="true"></div>
  
</div>

      

      <div class="about-author">
  <img src="http://www.gravatar.com/avatar/aadced6e13c05d42faaf1be3bbb88b83?s=135" width="135" height="135" alt="Miguel Camba" />
  <h3><a href="  /about">Miguel Camba</a></h3>
  
  <div class="author-description">I&#8217;m a web developer from Spain living in London. I do most of my work in Ruby/Rails and Javascript/Ember.js but I like to experiment with bleeding edge technologies. If you need help building your product, I might be able to help you.</div>
  
  <ul class="social-links">
    <li>
      <a href="https://github.com/cibernox" target="_blank">
        <i class="icon-github">GitHub</i>
      </a>
    </li>
    <li>
      <a href="https://www.linkedin.com/in/miguelcamba" target="_blank">
        <i class="icon-linkedin">Facebook</i>
      </a>
    </li>
    <li>
      <a href="https://twitter.com/miguelcamba" target="_blank">
        <i class="icon-twitter">Twitter</i>
      </a>
    </li>
    <li>
      <a href="  /atom.xml" target="_blank">
        <i class="icon-feed">Feed</i>
      </a>
    </li>
  </ul>
</div>


      
        <h4>Also read:</h4>
        <div class="others-posts">
          
            <a class="prev-post" href="  /blog/2015/06/18/how-to-inject-the-current-user-using-ember-simple-auth/" title="Post anterior: How to inject the current user using ember-simple-auth in Ember 2.0">
              How to inject the current user using ember-simple-auth in Ember 2.0
            </a>
          
          
            <a class="next-post" href="  /blog/2016/04/13/tricks-for-build-composable-components-part-1/" title="Próximo post: Trick for build composable components - Part 1">
              Trick for build composable components - Part 1
            </a>
          
        </div>
      
    </footer>
  </article>
  
  <section class="post-comments">
    <header>
      <h2>Comments:</h2>
    </header>
    
      <div id="disqus_thread"></div>
    
  </section>


</div>

    </main>
    <footer id="footer" role="contentinfo">
  <div class="content">
    <p class="copyright">Copyright &copy; 2017 - Miguel Camba</p>
    <p class="powered-by">Powered by <a href="http://octopress.org">Octopress</a></p>
  </div>
</footer>

    
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-40004935-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="  /javascripts/libs/jquery.min.js"><\/script>')</script>
<script src="  /javascripts/application.js"></script>


  
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement(s); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>


  
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



  
    <script type="text/javascript">
      var disqus_shortname = 'miguelcamba';
      
        // var disqus_developer = 1;
        var disqus_identifier = 'http://miguelcamba.com/blog/2016/01/24/ember-closure-actions-in-depth/';
        var disqus_url = 'http://miguelcamba.com/blog/2016/01/24/ember-closure-actions-in-depth/';
        var disqus_script = 'embed.js';
      

      (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }());
    </script>
  


  </body>
</html>
